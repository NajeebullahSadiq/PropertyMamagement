<div class="profile-image-cropper">
  <div class="profile-image-actions">
    <input
      type="file"
      #fileInput
      (change)="onFileSelected($event)"
      accept="image/png,image/jpeg,image/jpg,image/webp"
      style="display:none;"
    />

    <button type="button" class="btn btn-outline-secondary" (click)="fileInput.click()" [disabled]="isUploading">
      انتخاب عکس
    </button>

    <button type="button" class="btn btn-outline-primary" (click)="reset()" [disabled]="isUploading">
      حذف عکس
    </button>

    <button type="button" class="btn btn-success" (click)="uploadCroppedImage()" [disabled]="isUploading || !croppedBlob">
      ذخیره عکس
    </button>
  </div>

  <div class="profile-image-status" *ngIf="error">
    <small class="text-danger">{{ error }}</small>
  </div>

  <div class="profile-image-status" *ngIf="message">
    <small class="text-success">{{ message }}</small>
  </div>

  <div class="profile-image-progress" *ngIf="isUploading">
    <div class="progress" style="height: 8px;">
      <div class="progress-bar" role="progressbar" [style.width.%]="progress"></div>
    </div>
    <small class="text-muted">{{ progress }}%</small>
  </div>

  <div class="profile-image-body">
    <div class="profile-image-preview">
      <img
        class="preview-img"
        [class.round]="roundCropper"
        [src]="(croppedImageUrl || initialImageUrl || 'assets/img/avatar.png')"
        alt="Profile preview"
      />
    </div>

    <div class="profile-image-crop" *ngIf="imageChangedEvent">
      <div class="zoom-row">
        <label class="form-label">زوم</label>
        <input type="range" class="form-range" min="1" max="3" step="0.05" [(ngModel)]="zoom" />
      </div>

      <image-cropper
        [imageChangedEvent]="imageChangedEvent"
        [maintainAspectRatio]="true"
        [aspectRatio]="1 / 1"
        [roundCropper]="roundCropper"
        [transform]="{ scale: zoom }"
        [resizeToWidth]="512"
        format="jpeg"
        (imageCropped)="imageCropped($event)"
      ></image-cropper>
    </div>
  </div>
</div>
