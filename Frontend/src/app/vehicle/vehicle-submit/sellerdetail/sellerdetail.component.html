<section>
    <div class="container">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="heading-wrapper">
                            <img [src]="imagePath" class="seller-image" alt="Buyer Image">
                          
                            <p class="text-center h2 fw-bold mb-5 mx-1 mx-md-4 mt-4">ثبت مشخصات فروشنده</p> 
                        </div>
                        <app-profile-image-cropper
                          #childComponent
                          [initialImageUrl]="imagePath"
                          documentType="profile"
                          [roundCropper]="true"
                          (imageChanged)="profilePreviewChanged($event)"
                          (imageUploaded)="profileImageUploaded($event)"
                          style="text-align:left;"
                        ></app-profile-image-cropper>
                        <form [formGroup]="SellerForm"
                            (ngSubmit)="SellerForm.valid ? selectedSellerId ? updateSellerDetails() : addSellerDetail() : null">
                            <div class="form-group">
                                <input type="hidden" formControlName="id">
                            </div>

                            <!-- Duplicate Error Message -->
                            <div class="row" *ngIf="duplicateError">
                                <div class="col-md-12">
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert" style="border-left: 4px solid #dc3545; font-weight: 500;">
                                        <i class="fas fa-exclamation-circle" style="margin-left: 8px;"></i>
                                        {{ duplicateError }}
                                        <button type="button" class="btn-close" (click)="duplicateError = ''" aria-label="Close"></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Role Type Selection -->
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="roleType" class="form-label">نوعیت عاقد</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                                        <select id="roleType" class="form-control" formControlName="roleType">
                                            <option *ngFor="let role of roleTypes" [value]="role.value">{{ role.label }}</option>
                                        </select>
                                    </div>
                                    <div *ngIf="roleType?.invalid && (roleType?.dirty || roleType?.touched)">
                                        <small class="text-danger" *ngIf="roleType?.errors?.['required']">این فیلد الزامی است</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Conditional Authorization Letter Upload (for agents) -->
                            <div class="row mt-3" *ngIf="isAuthorizedAgent()">
                                <div class="col-md-12">
                                    <h5 style="font-weight: bold; color: #dc3545;">آپلود وکالت نامه (الزامی)</h5>
                                    <app-vehicle-fileupload #authLetterComponent (sendMessage)="authorizationLetterUploadFinished($event)" style="text-align:left;"></app-vehicle-fileupload>
                                    <div *ngIf="authorizationLetter?.invalid && (authorizationLetter?.dirty || authorizationLetter?.touched)">
                                        <small class="text-danger" *ngIf="authorizationLetter?.errors?.['required']">آپلود وکالت نامه الزامی است</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Conditional Heirs Letter Upload (for heirs) -->
                            <div class="row mt-3" *ngIf="isHeirs()">
                                <div class="col-md-12">
                                    <h5 style="font-weight: bold; color: #dc3545;">آپلود نامه ورثه (الزامی)</h5>
                                    <app-vehicle-fileupload #heirsLetterComponent (sendMessage)="heirsLetterUploadFinished($event)" style="text-align:left;"></app-vehicle-fileupload>
                                    <div *ngIf="heirsLetter?.invalid && (heirsLetter?.dirty || heirsLetter?.touched)">
                                        <small class="text-danger" *ngIf="heirsLetter?.errors?.['required']">آپلود نامه ورثه الزامی است</small>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="firstName" class="form-label">نام </label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text" id="firstName" class="form-control"
                                            formControlName="firstName">
                                        <div *ngIf="firstName?.invalid && (firstName?.dirty || firstName?.touched)">
                                            <small class="text-danger" *ngIf="firstName?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="fatherName" class="form-label">نام پدر </label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text" id="fatherName" class="form-control"
                                            formControlName="fatherName">
                                        <div *ngIf="fatherName?.invalid && (fatherName?.dirty || fatherName?.touched)">
                                            <small class="text-danger" *ngIf="fatherName?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                               
                            </div>
                            
                           
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="grandFather" class="form-label">نام پدر کلان</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text" id="grandFather" class="form-control"
                                            formControlName="grandFather">
                                        <div *ngIf="grandFather?.invalid && (grandFather?.dirty || grandFather?.touched)">
                                            <small class="text-danger" *ngIf="grandFather?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="indentityCardNumber" class="form-label"> شماره تذکره</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text"  (keypress)="onlyNumberKey($event)" id="indentityCardNumber" class="form-control"
                                            formControlName="indentityCardNumber">
                                        <div *ngIf="indentityCardNumber?.invalid && (indentityCardNumber?.dirty || indentityCardNumber?.touched)">
                                            <small class="text-danger" *ngIf="indentityCardNumber?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="phoneNumber" class="form-label"> شماره موبایل</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text"  (keypress)="onlyNumberKey($event)" id="phoneNumber" class="form-control"
                                            formControlName="phoneNumber">
                                        <div *ngIf="phoneNumber?.invalid && (phoneNumber?.dirty || phoneNumber?.touched)">
                                            <small class="text-danger" *ngIf="phoneNumber?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <br>
                                <section>
                                    <div class="row d-flex justify-content-center align-items-center h-100">  
                                        <h3 style="font-weight: bold;"> آپلود تذکره ملی فروشنده</h3>
                                        <div class="col-md-12">
                                            <app-vehicle-nationalid-upload #nationalIdComponent (sendMessage)="nationalIdUploadFinished($event)" style="text-align:left;"></app-vehicle-nationalid-upload>
                                            <div *ngIf="nationalIdCardPath?.invalid && (nationalIdCardPath?.dirty || nationalIdCardPath?.touched)">
                                                <small class="text-danger" *ngIf="nationalIdCardPath?.errors?.['required']">آپلود تذکره ملی الزامی است</small>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <br>
                                <section>
                                    <div class="row d-flex justify-content-center align-items-center h-100">  
                                                        <h3 style="font-weight: bold;"> سکونت اصلی</h3>
                                <div class="row">
                               
                                <div class="col-md-4">
                                    <label class="form-label me-3"> ولایت</label>
                                    <ng-select formControlName="paddressProvinceId" [items]="province" [selectOnTab]="true"
                                      bindLabel="dari" bindValue="id" (change)="filterResults($event)">
                                    </ng-select>
                                  
                                  </div>
                               
                                <div class="col-md-4">
                                    <label class="form-label me-3"> ناحیه/ولسوالی</label>
                                    <ng-select formControlName="paddressDistrictId" [items]="district" [selectOnTab]="true"
                                      bindLabel="dari" bindValue="id">
                                    </ng-select>
                                  
                                  </div>
                                <div class="col-md-4">
                                    <label for="paddressVillage" class="form-label"> ګذر / قریه / ادرس بلاک</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text" id="paddressVillage" class="form-control"
                                            formControlName="paddressVillage">
                                        <div *ngIf="paddressVillage?.invalid && (paddressVillage?.dirty || paddressVillage?.touched)">
                                            <small class="text-danger" *ngIf="paddressVillage?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                      
                          </div>    
                        </section>
                        <br>
                        <section>
                           
                            <div class="row">
                                <div class="row d-flex justify-content-center align-items-center h-100">  
                                    <h3 style="font-weight: bold;"> سکونت فعلی</h3>
                              
                                
                                <div class="col-md-4">
                                    <label class="form-label me-3"> ولایت </label>
                                    <ng-select formControlName="taddressProvinceId" [items]="province" [selectOnTab]="true"
                                      bindLabel="dari" bindValue="id" (change)="filterResults2($event)">
                                    </ng-select>
                                  
                                  </div>
                              
                                <div class="col-md-4">
                                    <label class="form-label me-3"> ناحیه/ولسوالی</label>
                                    <ng-select formControlName="taddressDistrictId" [items]="district2" [selectOnTab]="true"
                                      bindLabel="dari" bindValue="id">
                                    </ng-select>
                                  
                                  </div>
                                <div class="col-md-4">
                                    <label for="taddressVillage" class="form-label"> ګذر / قریه / ادرس بلاک </label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                        <input type="text" id="taddressVillage" class="form-control"
                                            formControlName="taddressVillage">
                                        <div *ngIf="taddressVillage?.invalid && (taddressVillage?.dirty || taddressVillage?.touched)">
                                            <small class="text-danger" *ngIf="taddressVillage?.errors?.['required']">این فیلد
                                                الزامی است</small>
                                        </div>
                                    </div>
                                </div>       
                            </div>
                        </div>
                        </section>
                        <br>
                        <button type="submit" [disabled]="SellerForm.invalid" class="btn btn-success">{{selectedSellerId ?
                          'تغیر معلومات' : 'ثبت معلومات'}}</button>
                        <button type="reset"  class="btn btn-primary"
                        style="margin-right: 5px;" (click)="resetChild()">جدید</button>
                        </form>
                    </div>
                </div>
                <br>
                <div class="container">
                <table class="table table-bordered">
                    <thead>
                      <tr style="text-align: center;">
                        <th> آی دی</th>
                        <th>نام</th>
                        <th>نام پدر</th>
                        <th>نام پدر کلان</th>
                        <th>شماره تذکره</th>
                        <th>شماره موبایل</th>
                        <th>نوعیت عاقد</th>
                        <th>عملیات</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let s of SellerDetails" style="text-align: center;">
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.id }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.firstName }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.fatherName }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.grandFather }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.indentityCardNumber }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.phoneNumber }}</td>
                        <td (click)="BindValue(s.id)" style="cursor: pointer;">{{ s.roleType }}</td>
                        <td>
                          <button class="btn btn-danger btn-sm" (click)="deleteSeller(s.id)">حذف</button>
                        </td>
                      </tr>
                      <tr *ngIf="!SellerDetails || SellerDetails.length === 0">
                        <td colspan="8" style="text-align: center;">هیچ فروشنده‌ای ثبت نشده است</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>
        </div>
    </div>
</section>


