<div class="verify-container">
  <!-- Header -->
  <div class="verify-header">
    <div class="header-content">
      <img src="/assets/img/afg.png" alt="ูุดุงู ูู ุงูุบุงูุณุชุงู" class="national-emblem">
      <div class="header-text">
        <h1>ุณุณุชู ุชุตุฏู ุงุณูุงุฏ</h1>
        <p>ูุฒุงุฑุช ุนุฏูู - ุฑุงุณุช ุงููุฑ ุฑูููุง ูุนุงููุงุช ู ุนุฑุถู ููุณุงู</p>
     </div>
    </div>
    <div class="header-description">
      <p>ุจุฑุง ุชุตุฏู ุงุนุชุจุงุฑ ุงุณูุงุฏ ุตุงุฏุฑ ุดุฏูุ ฺฉูุฏ ุชุตุฏู ุฑุง ูุงุฑุฏ ฺฉูุฏ ุง QR ฺฉูุฏ ุฑุง ุงุณฺฉู ููุงุฏ</p>
    </div>
  </div>

  <!-- Input Mode Tabs -->
  <div class="input-mode-tabs" *ngIf="!hasSearched">
    <button 
      class="tab-btn" 
      [class.active]="inputMode === 'manual'"
      (click)="switchToManual()"
    >
      <span class="tab-icon">โจ๏ธ</span>
      <span>ูุงุฑุฏ ฺฉุฑุฏู ฺฉูุฏ</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="inputMode === 'scanner'"
      (click)="switchToScanner()"
    >
      <span class="tab-icon">๐ท</span>
      <span>ุงุณฺฉู QR ฺฉูุฏ</span>
    </button>
  </div>

  <!-- Manual Input Section -->
  <div class="search-section" *ngIf="inputMode === 'manual' && !hasSearched">
    <div class="search-box">
      <label for="verificationCode">ฺฉูุฏ ุชุตุฏู ุณูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:</label>
      <div class="input-group">
        <input 
          type="text" 
          id="verificationCode"
          [(ngModel)]="verificationCode" 
          placeholder="ูุซุงู: LIC-2026-ABC123"
          (keyup.enter)="verifyDocument()"
          [disabled]="isLoading"
          class="verification-input"
          dir="ltr"
        >
        <button 
          (click)="verifyDocument()" 
          [disabled]="isLoading || !verificationCode"
          class="verify-btn"
        >
          <span *ngIf="!isLoading">ุชุตุฏู</span>
          <span *ngIf="isLoading">ุฏุฑ ุญุงู ุจุฑุฑุณ...</span>
        </button>
      </div>
      <p class="input-hint">ฺฉูุฏ ุชุตุฏู ุฏุฑ ูพุงู ุณูุฏ ฺุงูพ ุดุฏู ูุฑุงุฑ ุฏุงุฑุฏ</p>
    </div>
  </div>

  <!-- QR Scanner Section -->
  <div class="scanner-section" *ngIf="inputMode === 'scanner' && !hasSearched">
    <div class="scanner-box">
      <div class="scanner-header">
        <h3>ุงุณฺฉู QR ฺฉูุฏ</h3>
        <p>QR ฺฉูุฏ ุฑู ุณูุฏ ุฑุง ููุงุจู ฺฉูุฑู ูุฑุงุฑ ุฏูุฏ</p>
      </div>

      <!-- Scanner Error -->
      <div *ngIf="scannerError" class="scanner-error">
        <span class="error-icon">โ๏ธ</span>
        <p>{{ scannerError }}</p>
        <button (click)="startScanner()" class="retry-scanner-btn">ุชูุงุด ูุฌุฏุฏ</button>
      </div>

      <!-- Video Preview -->
      <div class="video-container" *ngIf="!scannerError">
        <video #videoElement playsinline autoplay muted class="scanner-video"></video>
        <canvas #canvasElement class="scanner-canvas"></canvas>
        
        <!-- Scanning Overlay -->
        <div class="scan-overlay" *ngIf="isScanning">
          <div class="scan-frame">
            <div class="corner top-left"></div>
            <div class="corner top-right"></div>
            <div class="corner bottom-left"></div>
            <div class="corner bottom-right"></div>
            <div class="scan-line"></div>
          </div>
        </div>

        <!-- Loading Camera -->
        <div class="camera-loading" *ngIf="!isScanning && !scannerError">
          <div class="spinner"></div>
          <p>ุฏุฑ ุญุงู ูุนุงูโุณุงุฒ ฺฉูุฑู...</p>
        </div>
      </div>

      <p class="scanner-hint">ฺฉูุฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุดูุงุณุง ูโุดูุฏ</p>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="spinner"></div>
    <p>ุฏุฑ ุญุงู ุชุตุฏู ุณูุฏ...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !isLoading" class="error-section">
    <div class="error-icon">โ๏ธ</div>
    <p>{{ error }}</p>
    <button (click)="resetSearch()" class="retry-btn">ุชูุงุด ูุฌุฏุฏ</button>
  </div>

  <!-- Result Section -->
  <div *ngIf="result && !isLoading" class="result-section">
    <!-- Status Banner -->
    <div class="status-banner" [ngClass]="getStatusClass()">
      <div class="status-icon">
        <span *ngIf="result.status === 'Valid'">โ</span>
        <span *ngIf="result.status === 'Expired'">โฐ</span>
        <span *ngIf="result.status === 'Revoked'">โ</span>
        <span *ngIf="result.status === 'Invalid'">โ</span>
      </div>
      <div class="status-text">
        <h2>{{ getStatusText() }}</h2>
        <p *ngIf="result.status === 'Valid'">ุงู ุณูุฏ ูุนุชุจุฑ ู ูุงุจู ุงุนุชูุงุฏ ุงุณุช</p>
        <p *ngIf="result.status === 'Expired'">ูุฏุช ุงุนุชุจุงุฑ ุงู ุณูุฏ ุจู ูพุงุงู ุฑุณุฏู ุงุณุช</p>
        <p *ngIf="result.status === 'Revoked'">ุงู ุณูุฏ ูุบู ุดุฏู ุงุณุช: {{ result.revokedReason }}</p>
        <p *ngIf="result.status === 'Invalid'">ุงู ฺฉูุฏ ุชุตุฏู ูุนุชุจุฑ ูุณุช</p>
      </div>
    </div>

    <!-- Document Details (only show if valid or expired) -->
    <div *ngIf="result.isValid || result.status === 'Expired'" class="document-details">
      <div class="detail-header">
        <h3>ูุนูููุงุช ุณูุฏ</h3>
        <span class="document-type">{{ getDocumentTypeText() }}</span>
      </div>

      <div class="detail-content">
        <!-- Photo -->
        <div class="photo-section">
          <img [src]="getPhotoUrl()" alt="ุนฺฉุณ ุฏุงุฑูุฏู ุฌูุงุฒ" class="holder-photo" onerror="this.src='assets/img/avatar2.png'">
        </div>

        <!-- Info Grid -->
        <div class="info-grid">
          <div class="info-item" *ngIf="result.licenseNumber">
            <label>ุดูุงุฑู ุฌูุงุฒ:</label>
            <span>{{ result.licenseNumber }}</span>
          </div>
          <div class="info-item" *ngIf="result.holderName">
            <label>ูุงู ุฏุงุฑูุฏู:</label>
            <span>{{ result.holderName }}</span>
          </div>
          <div class="info-item" *ngIf="result.companyTitle">
            <label>ูุงู ุฑูููุง:</label>
            <span>{{ result.companyTitle }}</span>
          </div>
          <div class="info-item" *ngIf="result.issueDate">
            <label>ุชุงุฑุฎ ุตุฏูุฑ:</label>
            <span>{{ result.issueDate | date:'yyyy/MM/dd' }}</span>
          </div>
          <div class="info-item" *ngIf="result.expiryDate">
            <label>ุชุงุฑุฎ ุงููุถุง:</label>
            <span>{{ result.expiryDate | date:'yyyy/MM/dd' }}</span>
          </div>
          <div class="info-item full-width" *ngIf="result.officeAddress">
            <label>ุขุฏุฑุณ ุฏูุชุฑ:</label>
            <span>{{ result.officeAddress }}</span>
          </div>
        </div>
      </div>

      <!-- Petition Writer Information (for PetitionWriterLicense documents) -->
      <div *ngIf="result.petitionWriterInfo" class="petition-writer-details">
        <div class="detail-section-header">
          <h4>ูุนูููุงุช ุชูุตู ุนุฑุถู ููุณ</h4>
        </div>
        
        <!-- Personal Information -->
        <div class="info-section">
          <h5 class="section-title">ูุนูููุงุช ุดุฎุต</h5>
          <div class="info-grid">
            <div class="info-item" *ngIf="result.petitionWriterInfo.applicantFatherName">
              <label>ูุงู ูพุฏุฑ:</label>
              <span>{{ result.petitionWriterInfo.applicantFatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.applicantGrandFatherName">
              <label>ูุงู ูพุฏุฑ ฺฉูุงู:</label>
              <span>{{ result.petitionWriterInfo.applicantGrandFatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.electronicNationalIdNumber">
              <label>ุดูุงุฑู ุชุฐฺฉุฑู:</label>
              <span dir="ltr">{{ result.petitionWriterInfo.electronicNationalIdNumber }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.mobileNumber">
              <label>ุดูุงุฑู ุชูุงุณ:</label>
              <span dir="ltr">{{ result.petitionWriterInfo.mobileNumber }}</span>
            </div>
          </div>
        </div>

        <!-- Permanent Address -->
        <div class="info-section" *ngIf="result.petitionWriterInfo.permanentProvinceName || result.petitionWriterInfo.permanentDistrictName || result.petitionWriterInfo.permanentVillage">
          <h5 class="section-title">ุณฺฉููุช ุงุตู</h5>
          <div class="info-grid">
            <div class="info-item" *ngIf="result.petitionWriterInfo.permanentProvinceName">
              <label>ููุงุช:</label>
              <span>{{ result.petitionWriterInfo.permanentProvinceName }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.permanentDistrictName">
              <label>ููุณูุงู:</label>
              <span>{{ result.petitionWriterInfo.permanentDistrictName }}</span>
            </div>
            <div class="info-item full-width" *ngIf="result.petitionWriterInfo.permanentVillage">
              <label>ูุงุญู / ูุฑู:</label>
              <span>{{ result.petitionWriterInfo.permanentVillage }}</span>
            </div>
          </div>
        </div>

        <!-- Current Address -->
        <div class="info-section" *ngIf="result.petitionWriterInfo.currentProvinceName || result.petitionWriterInfo.currentDistrictName || result.petitionWriterInfo.currentVillage">
          <h5 class="section-title">ุณฺฉููุช ูุนู</h5>
          <div class="info-grid">
            <div class="info-item" *ngIf="result.petitionWriterInfo.currentProvinceName">
              <label>ููุงุช:</label>
              <span>{{ result.petitionWriterInfo.currentProvinceName }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.currentDistrictName">
              <label>ููุณูุงู:</label>
              <span>{{ result.petitionWriterInfo.currentDistrictName }}</span>
            </div>
            <div class="info-item full-width" *ngIf="result.petitionWriterInfo.currentVillage">
              <label>ูุฑู / ฺฏุฐุฑ:</label>
              <span>{{ result.petitionWriterInfo.currentVillage }}</span>
            </div>
          </div>
        </div>

        <!-- Activity Location -->
        <div class="info-section" *ngIf="result.petitionWriterInfo.district || result.petitionWriterInfo.detailedAddress || result.petitionWriterInfo.latestRelocation">
          <h5 class="section-title">ูุญู ูุนุงูุช</h5>
          <div class="info-grid">
            <div class="info-item" *ngIf="result.petitionWriterInfo.district">
              <label>ูุงุญู:</label>
              <span>{{ result.petitionWriterInfo.district }}</span>
            </div>
            <div class="info-item full-width" *ngIf="result.petitionWriterInfo.detailedAddress">
              <label>ุขุฏุฑุณ ุฏูู:</label>
              <span>{{ result.petitionWriterInfo.detailedAddress }}</span>
            </div>
            <div class="info-item full-width" *ngIf="result.petitionWriterInfo.latestRelocation">
              <label>ููู ูฺฉุงู:</label>
              <span>{{ result.petitionWriterInfo.latestRelocation }}</span>
            </div>
          </div>
        </div>

        <!-- License Details -->
        <div class="info-section" *ngIf="result.petitionWriterInfo.competency || result.petitionWriterInfo.licenseType || result.petitionWriterInfo.licensePrice">
          <h5 class="section-title">ูุนูููุงุช ุฌูุงุฒ</h5>
          <div class="info-grid">
            <div class="info-item" *ngIf="result.petitionWriterInfo.competency">
              <label>ุงููุช:</label>
              <span>{{ getCompetencyDisplay(result.petitionWriterInfo.competency) }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.licenseType">
              <label>ููุน ุฌูุงุฒ:</label>
              <span>{{ getLicenseTypeDisplay(result.petitionWriterInfo.licenseType) }}</span>
            </div>
            <div class="info-item" *ngIf="result.petitionWriterInfo.licensePrice">
              <label>ููุช ุฌูุงุฒ:</label>
              <span>{{ result.petitionWriterInfo.licensePrice }} ุงูุบุงู</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Seller Information (for Property and Vehicle documents) -->
      <div *ngIf="result.sellerInfo" class="party-details seller-details">
        <div class="party-header">
          <h4>ูุนูููุงุช ูุฑูุดูุฏู</h4>
        </div>
        <div class="party-content">
          <!-- Seller Photo -->
          <div class="party-photo-section" *ngIf="result.sellerInfo.photo">
            <img [src]="getSellerPhotoUrl()" alt="ุนฺฉุณ ูุฑูุดูุฏู" class="party-photo" onerror="this.src='assets/img/avatar2.png'">
          </div>
          
          <!-- Seller Info Grid -->
          <div class="party-info-grid">
            <div class="info-item" *ngIf="result.sellerInfo.firstName">
              <label>ูุงู:</label>
              <span>{{ result.sellerInfo.firstName }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.fatherName">
              <label>ูุงู ูพุฏุฑ:</label>
              <span>{{ result.sellerInfo.fatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.grandFatherName">
              <label>ูุงู ูพุฏุฑ ฺฉูุงู:</label>
              <span>{{ result.sellerInfo.grandFatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.electronicNationalIdNumber">
              <label>ุดูุงุฑู ุชุฐฺฉุฑู:</label>
              <span dir="ltr">{{ result.sellerInfo.electronicNationalIdNumber }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.phoneNumber">
              <label>ุดูุงุฑู ุชูุงุณ:</label>
              <span dir="ltr">{{ result.sellerInfo.phoneNumber }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.province">
              <label>ููุงุช:</label>
              <span>{{ result.sellerInfo.province }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.district">
              <label>ููุณูุงู:</label>
              <span>{{ result.sellerInfo.district }}</span>
            </div>
            <div class="info-item" *ngIf="result.sellerInfo.village">
              <label>ูุฑู/ฺฏุฐุฑ:</label>
              <span>{{ result.sellerInfo.village }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Buyer Information (for Property and Vehicle documents) -->
      <div *ngIf="result.buyerInfo" class="party-details buyer-details">
        <div class="party-header">
          <h4>ูุนูููุงุช ุฎุฑุฏุงุฑ</h4>
        </div>
        <div class="party-content">
          <!-- Buyer Photo -->
          <div class="party-photo-section" *ngIf="result.buyerInfo.photo">
            <img [src]="getBuyerPhotoUrl()" alt="ุนฺฉุณ ุฎุฑุฏุงุฑ" class="party-photo" onerror="this.src='assets/img/avatar2.png'">
          </div>
          
          <!-- Buyer Info Grid -->
          <div class="party-info-grid">
            <div class="info-item" *ngIf="result.buyerInfo.firstName">
              <label>ูุงู:</label>
              <span>{{ result.buyerInfo.firstName }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.fatherName">
              <label>ูุงู ูพุฏุฑ:</label>
              <span>{{ result.buyerInfo.fatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.grandFatherName">
              <label>ูุงู ูพุฏุฑ ฺฉูุงู:</label>
              <span>{{ result.buyerInfo.grandFatherName }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.electronicNationalIdNumber">
              <label>ุดูุงุฑู ุชุฐฺฉุฑู:</label>
              <span dir="ltr">{{ result.buyerInfo.electronicNationalIdNumber }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.phoneNumber">
              <label>ุดูุงุฑู ุชูุงุณ:</label>
              <span dir="ltr">{{ result.buyerInfo.phoneNumber }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.province">
              <label>ููุงุช:</label>
              <span>{{ result.buyerInfo.province }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.district">
              <label>ููุณูุงู:</label>
              <span>{{ result.buyerInfo.district }}</span>
            </div>
            <div class="info-item" *ngIf="result.buyerInfo.village">
              <label>ูุฑู/ฺฏุฐุฑ:</label>
              <span>{{ result.buyerInfo.village }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="verification-info">
        <p>ฺฉูุฏ ุชุตุฏู: <strong dir="ltr">{{ result.verificationCode }}</strong></p>
        <p>ุชุงุฑุฎ ุชุตุฏู: {{ result.verifiedAt | date:'yyyy/MM/dd HH:mm' }}</p>
      </div>
    </div>

    <!-- Search Again Button -->
    <div class="action-section">
      <button (click)="resetSearch()" class="search-again-btn">ุชุตุฏู ุณูุฏ ุฏฺฏุฑ</button>
    </div>
  </div>

  <!-- Footer -->
  <div class="verify-footer">
    <p>ยฉ {{ currentYear }} ูุฒุงุฑุช ุนุฏูู - ุชูุงู ุญููู ูุญููุธ ุงุณุช</p>
    <p class="help-text">ุจุฑุง ุชุตุฏู ุณูุฏุ ฺฉูุฏ QR ุฑู ุณูุฏ ุฑุง ุงุณฺฉู ฺฉูุฏ ุง ฺฉูุฏ ุชุตุฏู ุฑุง ูุงุฑุฏ ููุงุฏ</p>
  </div>
</div>
