<!-- Loading Indicator -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner">
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
  </div>
  <p>در حال بارگذاری معلومات جواز...</p>
</div>

<div *ngIf="!isLoading && error" class="error-container">
  <div class="error-icon">⚠</div>
  <p>{{ error }}</p>
</div>

<div class="pw-page" *ngIf="!isLoading && !error" dir="rtl">
  <div class="pw-header">
    <div class="pw-header-column pw-header-column--left">
      <div class="pw-header-logo">
        <img src="assets/img/mcitlogo.png" alt="Logo" class="pw-logo" />
      </div>
      <div class="pw-photo">
        <div class="pw-photo-box">
          <img *ngIf="data.picturePath" [src]="getImageUrl(data.picturePath)" alt="Photo" class="pw-photo-img" onerror="this.src='assets/img/avatar.png'" />
          <img *ngIf="!data.picturePath" src="assets/img/avatar.png" alt="Photo" class="pw-photo-img" />
        </div>
        <div class="pw-photo-text">فوتو</div>
      </div>
    </div>
    
    <div class="pw-header-title">
      <div class="pw-title-line">امارت اسلامی افغانستان</div>
      <div class="pw-title-line">وزارت عدلیه</div>
      <div class="pw-subtitle-line">ریاست عمومی انسجام</div>
      <div class="pw-subtitle-line">ریاست امور رهنمای معاملات و عریضه نویسان</div>
      <div class="pw-subtitle-line">آمریت رهنمای معاملات و عریضه نویسان</div>
      <div class="pw-subtitle-line">مدیریت بررسی و ثبت جواز عریضه نویسان</div>
      <div class="pw-title-strong">جواز فعالیت عریضه نویسی</div>
    </div>
    
    <div class="pw-header-column pw-header-column--right">
      <div class="pw-header-logo">
        <img src="assets/img/afg.png" alt="Logo" class="pw-logo" />
      </div>
      <div class="pw-meta">
        <div class="pw-meta-item">
          <span class="pw-meta-label">نمبر جواز:</span>
          <span class="pw-meta-value">{{ data.licenseNumber }}</span>
        </div>
        <div class="pw-meta-item">
          <span class="pw-meta-label">تاریخ صدور:</span>
          <span class="pw-meta-value">{{ data.licenseIssueDateFormatted || '-' }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="pw-content">

    <div class="pw-form">
      <div class="pw-form-title">شهرت عریضه نویس</div>

      <div class="pw-grid-head">
        <div>شهرت و سکونت اصلی</div>
        <div>سکونت فعلی</div>
      </div>

      <div class="pw-grid">
        <div class="pw-cell pw-label">نام و تخلص</div>
        <div class="pw-cell pw-value">{{ data.applicantName || '-' }}</div>
        <div class="pw-cell pw-label">ولایت</div>
        <div class="pw-cell pw-value">{{ data.currentProvinceName || '-' }}</div>

        <div class="pw-cell pw-label">ولد</div>
        <div class="pw-cell pw-value">{{ data.applicantFatherName || '-' }}</div>
        <div class="pw-cell pw-label">ولسوالی</div>
        <div class="pw-cell pw-value">{{ data.currentDistrictName || '-' }}</div>

        <div class="pw-cell pw-label">نمبر تذکره</div>
        <div class="pw-cell pw-value">{{ data.electronicIdNumber || '-' }}</div>
        <div class="pw-cell pw-label">ناحیه</div>
        <div class="pw-cell pw-value">{{ data.currentVillage || '-' }}</div>

        <div class="pw-cell pw-label">ولایت</div>
        <div class="pw-cell pw-value">{{ data.permanentProvinceName || '-' }}</div>
        <div class="pw-cell pw-label">محل فعالیت</div>
        <div class="pw-cell pw-value">{{ data.activityLocation || '-' }}</div>

        <div class="pw-cell pw-label">ولسوالی</div>
        <div class="pw-cell pw-value">{{ data.permanentDistrictName || '-' }}</div>
        <div class="pw-cell pw-label">قریه / گذر</div>
        <div class="pw-cell pw-value">{{ data.currentVillage || '-' }}</div>

        <div class="pw-cell pw-label">ناحیه / قریه</div>
        <div class="pw-cell pw-value">{{ data.permanentVillage || '-' }}</div>
        <div class="pw-cell pw-label"></div>
        <div class="pw-cell pw-value"></div>
      </div>

      <div class="pw-bottom">
        <div class="pw-bottom-col">
          <div class="pw-bottom-title">مرجع صلاحیت و امضاء</div>
          <div class="pw-bottom-body">
            <div class="pw-bottom-center">ریاست عمومی انسجام</div>
            <div class="pw-bottom-space"></div>
            <div class="pw-bottom-center">امضاء رئیس</div>
          </div>
        </div>
        <div class="pw-bottom-col">
          <div class="pw-bottom-title">نظر به درمورد</div>
          <div class="pw-bottom-body pw-bottom-text">
            در اهلیت عریضه نویسی بعد از اخذ امتحان نظر هیئت داده شد، که این عریضه نویس به درجه اعلی، اوسط، ادنی لیاقت و اهلیت دارد.
            <div class="pw-bottom-center">مهر</div>
          </div>
        </div>
        <div class="pw-bottom-col">
          <div class="pw-bottom-title">معلومات جواز عریضه نویسی</div>
          <div class="pw-bottom-body">
            <div class="pw-kv"><span>اعتبار از تاریخ:</span><span class="pw-kv-value">{{ data.licenseIssueDateFormatted || '-' }}</span></div>
            <div class="pw-kv"><span>الی:</span><span class="pw-kv-value">{{ data.licenseExpiryDateFormatted || '-' }}</span></div>
            <div class="pw-kv pw-kv-last"><span>نمبر ثبت:</span><span class="pw-kv-value">( )</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Code Verification Section -->
  <div class="pw-verification-section" *ngIf="verificationCode">
    <div class="pw-verification-container">
      <div class="pw-qr-code">
        <img [src]="qrCodeUrl" alt="QR Code" class="pw-qr-image" *ngIf="qrCodeUrl">
      </div>
      <div class="pw-verification-info">
        <div class="pw-verification-title">تصدیق اصالت سند</div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">کود تصدیق:</span>
          <span class="pw-verification-value">{{ verificationCode }}</span>
        </div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">نام عریضه نویس:</span>
          <span class="pw-verification-value">{{ data.applicantName || '—' }}</span>
        </div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">نام پدر:</span>
          <span class="pw-verification-value">{{ data.applicantFatherName || '—' }}</span>
        </div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">نمبر جواز:</span>
          <span class="pw-verification-value">{{ data.licenseNumber || '—' }}</span>
        </div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">تاریخ صدور:</span>
          <span class="pw-verification-value">{{ data.licenseIssueDateFormatted || '—' }}</span>
        </div>
        <div class="pw-verification-row">
          <span class="pw-verification-label">محل فعالیت:</span>
          <span class="pw-verification-value">{{ data.activityLocation || '—' }}</span>
        </div>
        <div class="pw-verification-note">
          برای تصدیق اصالت این سند، کود QR را اسکن نمایید یا کود تصدیق را در پورتال تصدیق وزارت عدلیه وارد کنید.
        </div>
      </div>
    </div>
  </div>

  <!-- Verification Error -->
  <div class="pw-verification-error" *ngIf="verificationError && !verificationCode">
    <div class="pw-error-icon">⚠</div>
    <div class="pw-error-text">{{ verificationError }}</div>
    <div class="pw-error-note">برای تصدیق با اداره تماس بگیرید</div>
  </div>
</div>
