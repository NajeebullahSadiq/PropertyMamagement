<!-- Loading Indicator -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner">
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
  </div>
  <p>Ù¾Ù‡ Ø­Ø§Ù„ Ú©Û Ø¯ Ø¬ÙˆØ§Ø² Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø§Ø±ÛÚ–ÙŠ...</p>
</div>

<div *ngIf="!isLoading && error" class="error-container">
  <div class="error-icon">âš </div>
  <p>{{ error }}</p>
</div>

<div class="certificate-page" *ngIf="!isLoading && !error">
  <div class="certificate-wrapper">
    <!-- Watermark Background -->
    <div class="watermark-layer">
      <div class="watermark-logo">
        <img src="/assets/img/mcitlogo.png" alt="Watermark Logo" class="watermark-logo-image">
      </div>
      <div class="watermark-circle">
        <div class="watermark-text">
          <div class="watermark-line">{{data.licenseNumber || 'â€”'}}</div>
          <div class="watermark-line">{{data.firstName || 'â€”'}}</div>
          <div class="watermark-line">{{data.fatherName || 'â€”'}}</div>
          <div class="watermark-line">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'â€”'}}</div>
          <div class="watermark-line">{{data.indentityCardNumber || 'â€”'}}</div>
        </div>
      </div>
    </div>

    <!-- Guilloche Pattern Border -->
    <div class="guilloche-border">
      <svg class="guilloche-pattern" viewBox="0 0 100 100" preserveAspectRatio="none">
        <defs>
          <pattern id="guillochePattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <circle cx="10" cy="10" r="8" fill="none" stroke="rgba(25, 118, 210, 0.15)" stroke-width="0.5" />
            <circle cx="10" cy="10" r="5" fill="none" stroke="rgba(25, 118, 210, 0.1)" stroke-width="0.3" />
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#guillochePattern)" />
      </svg>
    </div>

    <!-- Main Certificate Frame -->
    <div class="certificate-frame">
      <!-- Ornate Corner Decorations -->
      <div class="corner-ornament top-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,60 Q0,0 60,0" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M5,60 Q5,5 60,5" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="15" cy="45" r="3" fill="#1976d2" />
          <circle cx="45" cy="15" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament top-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,60 Q60,0 0,0" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M55,60 Q55,5 0,5" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="45" cy="45" r="3" fill="#1976d2" />
          <circle cx="15" cy="15" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament bottom-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,0 Q0,60 60,60" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M5,0 Q5,55 60,55" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="15" cy="15" r="3" fill="#1976d2" />
          <circle cx="45" cy="45" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament bottom-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,0 Q60,60 0,60" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M55,0 Q55,55 0,55" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="45" cy="15" r="3" fill="#1976d2" />
          <circle cx="15" cy="45" r="3" fill="#1976d2" />
        </svg>
      </div>

      <!-- Certificate Content -->
      <div class="certificate-content">
        <!-- Header Section -->
        <header class="certificate-header">
          <!-- Right Column: National Emblem & License Info -->
          <div class="header-right">
            <div class="emblem-container">
              <img src="/assets/img/afg.png" alt="Ù†Ø´Ø§Ù† Ù…Ù„ÛŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†" class="national-emblem">
            </div>
            <div class="license-meta">
              <div class="meta-item">
                <span class="meta-label">Ø¯ Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Û Ø´Ù…ÛØ±Ù‡</span>
                <span class="meta-value">{{data.licenseNumber || 'â€”'}}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Ø¯ ØµØ¯ÙˆØ± Ù†ÛÙ¼Ù‡:</span>
                <span class="meta-value">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'â€”'}}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Ø¯ Ø®ØªÙ… Ù†ÛÙ¼Ù‡:</span>
                <span class="meta-value">{{data.expireDateFormatted || (data.expireDate | calendarDate) || 'â€”'}}</span>
              </div>
            </div>
          </div>

          <!-- Center Column: Ministry Info -->
          <div class="header-center">
            <img src="/assets/img/islamicLogo.png" alt="imerat" class="islamic-logo">
            <div class="ministry-divider">
              <span class="divider-line"></span>
              <span class="divider-diamond">â—†</span>
              <span class="divider-line"></span>
            </div>
            <h2 class="ministry-name">Ø¯ Ø¹Ø¯Ù„ÛŒÛ ÙˆØ²Ø§Ø±Øª</h2>
            <h3 class="department-name">Ù…Ø§Ù„ÙŠ Ø§Ùˆ Ø§Ø¯Ø§Ø±ÙŠ Ù…Ø¹ÛŒÙ†ÛŒØª</h3>
            <h3 class="department-name">Ø¯ Ø§Ù†Ø³Ø¬Ø§Ù… Ù„ÙˆÛŒ Ø±ÛŒØ§Ø³Øª</h3>
             
            <h4 class="sub-department">Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙˆ Ù„Ø§Ø±ÚšÙˆØ§Ù†Ùˆ Ø§Ùˆ Ø¹Ø±ÛŒØ¶Ù‡ Ù„ÛŒÚ©ÙˆÙ†Ú©Ùˆ Ú†Ø§Ø±Ùˆ Ø±ÛŒØ§Ø³Øª</h4>
          </div>

          <!-- Left Column: Logo & Photo -->
          <div class="header-left">
            <div class="logo-photo-stack">
              <img src="/assets/img/mcitlogo.png" alt="Ù„ÙˆÚ¯Ùˆ ÙˆØ²Ø§Ø±Øª" class="ministry-logo">
              <div class="photo-container">
                <div class="photo-frame">
                  <img [src]="filePath" alt="Ø¹Ú©Ø³" class="owner-photo" onerror="this.src='assets/img/avatar2.png'">
                </div>
               
              </div>
            </div>
          </div>
        </header>

        <!-- Title Banner -->
        <div class="title-banner">
          <div class="banner-decoration left"></div>
          <div class="title-content-wrapper">
            <!-- License Type Badge -->
            <div class="license-type-badge">
              <span class="license-type-icon">
                <ng-container *ngIf="getLicenseTypeInPashto(data.licenseType) === 'Ø§Ù…Ù„Ø§Ú©'">ğŸ¢</ng-container>
                <ng-container *ngIf="getLicenseTypeInPashto(data.licenseType) === 'Ù…ÙˆÙ¼Ø± ÙØ±ÙˆØ´ÛŒ'">ğŸš—</ng-container>
              </span>
              <span class="license-type-label">Ø¯ Ø¬ÙˆØ§Ø² Ú‰ÙˆÙ„:</span>
              <span class="license-type-value">{{getLicenseTypeInPashto(data.licenseType)}}</span>
            </div>
            <h2 class="certificate-title">
              Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙˆ Ù„Ø§Ø±ÚšÙˆØ¯ Ø¯ ÙØ¹Ø§Ù„ÛŒØª Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Ù‡
              <span class="title-highlight">({{data.title || 'â€”'}})</span>
            </h2>
          </div>
          <div class="banner-decoration right"></div>
        </div>

        <!-- Main Body -->
        <main class="certificate-body">
          <!-- Personal Information Card -->
          <div class="info-card personal-info">
            <p class="info-paragraph">
              Ù…Ø­ØªØ±Ù… <span class="highlight-value">{{data.firstName || 'â€”'}}</span>
              Ø¯ <span class="highlight-value">{{data.fatherName || 'â€”'}}</span>
              Ø²ÙˆÛŒ Ø¯ <span class="highlight-value">{{data.grandFatherName || 'â€”'}}</span>
              Ù„Ù…Ø³ÛŒ Ø¯ <span class="highlight-value">{{data.dateOfBirthFormatted || (data.dateofBirth | calendarDate)
                || 'â€”'}}</span>
              Ú©Ø§Ù„ Ø²ÛÚ–ÛØ¯Ù„ÛŒ Ø¯ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÙŠ ØªØ°Ú©Ø±Û Ù„Ø±ÙˆÙ†Ú©ÛŒ <span class="highlight-value">{{data.indentityCardNumber || 'â€”'}}</span>
            </p>
          </div>

          <!-- Address Information -->
          <div class="info-card address-info">
            <p class="info-paragraph">
              <span class="label-accent">Ø§ØµÙ„ÙŠ Ø§Ø³ØªÙˆÚ«Ù†ÚØ§ÛŒ Ù†Ø§Ø­ÛŒÙ‡ ÛŒØ§ ÙˆÙ„Ø³ÙˆØ§Ù„Û</span>
              <span class="highlight-value">{{data.ownerDistrictName || 'â€”'}}</span>
              <span class="label-accent">ÙˆÙ„Ø§ÛŒØª</span>
              <span class="highlight-value">{{data.ownerProvinceName || 'â€”'}}</span>
              <span class="label-accent">Ø§ÙˆØ³Ù†ÛŒ Ø§Ø³ØªÙˆÚ«Ù†ÚØ§ÛŒ Ù†Ø§Ø­ÛŒÙ‡ ÛŒØ§ ÙˆÙ„Ø³ÙˆØ§Ù„Û</span>
              <span class="highlight-value">{{data.permanentDistrictName || 'â€”'}}</span>
              <span class="label-accent">ÙˆÙ„Ø§ÛŒØª</span>
              <span class="highlight-value">{{data.permanentProvinceName || 'â€”'}}</span>
              
            </p>
          </div>

          <!-- Authorization Statement -->
          <div class="info-card authorization-card">
            <p class="info-paragraph authorization-text">
              <span class="label-accent">ÙˆØ§Ù‚Ø¹ Ù†Ø§Ø­ÛŒÙ‡</span>
              <span class="highlight-value">({{data.permanentVillage || data.ownerVillage || 'â€”'}})</span>
              Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙˆ Ù„Ø§Ø±ÚšÙˆØ¯ Ù‚Ø§Ù†ÙˆÙ† Ù¾Ù‡ Ù¾Ø§Ù… Ú©Û Ù†ÛŒÙˆÙ„Ùˆ Ø³Ø±Ù‡ Ø¯Ø§ Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Ù‡ ÙˆØ±Ú©ÙˆÙ„ Ú©ÛÚ–ÙŠ
              <br>
              Ø§Ùˆ Ù¾Ø± Ø§Ø³Ø§Ø³ ÛŒÛ Ù…ÙˆØµÙˆÙ Ú©ÙˆÙ„Ø§ÛŒ Ø´ÙŠ Ø¯ Ù‚Ø§Ù†ÙˆÙ† Ø¯ Ø­Ú©Ù…ÙˆÙ†Ùˆ Ù¾Ù‡ Ø­Ø¯ÙˆØ¯Ùˆ Ú©Û Ø¯ Ø§Ø´Ø®Ø§ØµÙˆ ØªØ± Ù…Ù†Ú Ù¾Ù‡ Ø¹Ù‚ÙˆØ¯Ùˆ Ø§Ùˆ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙˆ Ú©Û Ù…Ù†ÚÚ«Ú“ÛŒØªÙˆØ¨ ÙˆÚ©Ú“ÙŠ.
            </p>
          </div>

          <!-- Inquiry Reference -->
          <div class="inquiry-line">
            <span>Ø¯ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù¾Ù‡ Ø´Ù…ÛØ±Ù‡</span>
            <span
              class="inquiry-field">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span>Ù…Ø·Ø¨Ø¹Û ØªÙ‡ Ù…Ø¹Ø±ÙÙŠ Ø´Ùˆ.</span>
          </div>

          <!-- Signature Section -->
          <div class="signature-section">
            <div class="signature-block">
              <p class="signature-greeting">Ù¾Ù‡ Ø¯Ø±Ù†Ø§ÙˆÙŠ</p>
              <div class="signature-line"></div>
              <p class="signature-title">Ø¯ Ø§Ù†Ø³Ø¬Ø§Ù… Ù„ÙˆÛŒ Ø±Ø¦ÛŒØ³</p>
            </div>
          </div>
        </main>

        <!-- Footer Section -->
        <footer class="certificate-footer">
          <!-- Office Address -->
          <div class="footer-row address-row">
            <span class="footer-label">Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙˆ Ù„Ø§Ø±ÚšÙˆØ¯ Ø¯ÙØªØ± Ù¾ØªÙ‡:</span>
            <span class="footer-value">{{data.officeAddress || 'â€”'}}</span>
          </div>

          <!-- Important Note -->
          <div class="validity-notice">
            <span class="notice-icon">ğŸ“Œ</span>
            <span class="notice-label">ÛŒØ§Ø¯ÚšØª:</span>
            <span class="notice-text">Ø¯ Ø¯Û Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Û Ø¯ Ø§Ø¹ØªØ¨Ø§Ø± Ù…ÙˆØ¯Ù‡ Ø¯ ØµØ¯ÙˆØ± Ù„Ù‡ Ù†ÛÙ¼Û Ú…Ø®Ù‡ Ø¯ Ø¯Ø±ÛÙˆ Ú©Ù„ÙˆÙ†Ùˆ Ù„Ù¾Ø§Ø±Ù‡ Ø¯Ù‡.</span>
          </div>

          <!-- License Details Row -->
          <div class="footer-row details-row">
            <span>Ø¯ Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Û Ù„Ø±ÙˆÙ†Ú©ÙŠ Ø¯ ØªÙ…Ø§Ø³ Ø´Ù…ÛØ±Ù‡: <strong class="footer-value">{{data.phoneNumber || 'â€”'}}</strong></span>
            <span>Ø¯ Ù¾ÛÚ˜Ù†Ø¯Ù†Û Ø´Ù…ÛØ±Ù‡ <strong class="footer-value">{{data.tin || 'â€”'}}</strong></span>
            <span>Ø¯ Ø¬ÙˆØ§Ø²Ù†Ø§Ù…Û Ø¨ÛŒÙ‡: <strong class="footer-value">Ù¾Ù†ÚÙ„Ø³ Ø²Ø±Ù‡ Ø§ÙØºØ§Ù†Û</strong></span>
          </div>

          <!-- QR Code Verification Row -->
          <div class="verification-row" *ngIf="verificationCode">
            <div class="qr-code-container">
              <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" *ngIf="qrCodeUrl">
            </div>
            <div class="verification-details">
              <div class="verification-item">
                <span class="verification-label">Ø¯ Ø³Ù†Ø¯ Ø¯ ØªØµØ¯ÛŒÙ‚ Ú©ÙˆÚ‰:</span>
                <span class="verification-code">{{ verificationCode }}</span>
              </div>
              <div class="verification-item">
                <span class="verification-label">Ø´Ù‡Ø±Øª:</span>
                <span class="verification-value">{{ data.firstName || 'â€”' }} {{ data.fatherName || 'â€”' }}</span>
              </div>
            </div>
          </div>

          <!-- Verification Error -->
          <div class="verification-row error" *ngIf="verificationError && !verificationCode">
            <div class="error-content">
              <span class="error-text">{{ verificationError }}</span>
              <span class="verification-label">Ø¯ ØªØµØ¯ÛŒÙ‚ Ù„Ù¾Ø§Ø±Ù‡ Ù„Ù‡ Ø§Ø¯Ø§Ø±Û Ø³Ø±Ù‡ Ø§Ú“ÛŒÚ©Ù‡ ÙˆÙ†ÛŒØ³Ø¦</span>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>
</div>