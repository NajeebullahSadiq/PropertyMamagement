<!-- Loading Indicator -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner">
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
  </div>
  <p>ูพู ุญุงู ฺฉ ุฏ ุฌูุงุฒ ูุนูููุงุช ุจุงุฑฺู...</p>
</div>

<div *ngIf="!isLoading && error" class="error-container">
  <div class="error-icon">โ</div>
  <p>{{ error }}</p>
</div>

<div class="certificate-page" *ngIf="!isLoading && !error">
  <div class="certificate-wrapper">
    <!-- Watermark Background -->
    <div class="watermark-layer">
      <div class="watermark-logo">
        <img src="/assets/img/mcitlogo.png" alt="Watermark Logo" class="watermark-logo-image">
      </div>
      <div class="watermark-circle">
        <div class="watermark-text">
          <div class="watermark-line">{{data.licenseNumber || 'โ'}}</div>
          <div class="watermark-line">{{data.firstName || 'โ'}}</div>
          <div class="watermark-line">{{data.fatherName || 'โ'}}</div>
          <div class="watermark-line">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'โ'}}</div>
          <div class="watermark-line">{{data.indentityCardNumber || 'โ'}}</div>
        </div>
      </div>
    </div>

    <!-- Guilloche Pattern Border -->
    <div class="guilloche-border">
      <svg class="guilloche-pattern" viewBox="0 0 100 100" preserveAspectRatio="none">
        <defs>
          <pattern id="guillochePattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <circle cx="10" cy="10" r="8" fill="none" stroke="rgba(25, 118, 210, 0.15)" stroke-width="0.5" />
            <circle cx="10" cy="10" r="5" fill="none" stroke="rgba(25, 118, 210, 0.1)" stroke-width="0.3" />
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#guillochePattern)" />
      </svg>
    </div>

    <!-- Main Certificate Frame -->
    <div class="certificate-frame">
      <!-- Ornate Corner Decorations -->
      <div class="corner-ornament top-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,60 Q0,0 60,0" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M5,60 Q5,5 60,5" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="15" cy="45" r="3" fill="#1976d2" />
          <circle cx="45" cy="15" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament top-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,60 Q60,0 0,0" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M55,60 Q55,5 0,5" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="45" cy="45" r="3" fill="#1976d2" />
          <circle cx="15" cy="15" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament bottom-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,0 Q0,60 60,60" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M5,0 Q5,55 60,55" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="15" cy="15" r="3" fill="#1976d2" />
          <circle cx="45" cy="45" r="3" fill="#1976d2" />
        </svg>
      </div>
      <div class="corner-ornament bottom-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,0 Q60,60 0,60" fill="none" stroke="#1565c0" stroke-width="2" />
          <path d="M55,0 Q55,55 0,55" fill="none" stroke="#42a5f5" stroke-width="1" />
          <circle cx="45" cy="15" r="3" fill="#1976d2" />
          <circle cx="15" cy="45" r="3" fill="#1976d2" />
        </svg>
      </div>

      <!-- Certificate Content -->
      <div class="certificate-content">
        <!-- Header Section -->
        <header class="certificate-header">
          <!-- Right Column: National Emblem & License Info -->
          <div class="header-right">
            <div class="emblem-container">
              <img src="/assets/img/afg.png" alt="ูุดุงู ูู ุงูุบุงูุณุชุงู" class="national-emblem">
            </div>
            <div class="license-meta">
              <div class="meta-item">
                <span class="meta-label">ุฏ ุฌูุงุฒูุงู ุดูุฑู</span>
                <span class="meta-value">{{data.licenseNumber || 'โ'}}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">ุฏ ุตุฏูุฑ ููผู:</span>
                <span class="meta-value">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'โ'}}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">ุฏ ุฎุชู ููผู:</span>
                <span class="meta-value">{{data.expireDateFormatted || (data.expireDate | calendarDate) || 'โ'}}</span>
              </div>
            </div>
          </div>

          <!-- Center Column: Ministry Info -->
          <div class="header-center">
            <img src="/assets/img/islamicLogo.png" alt="imerat" class="islamic-logo">
            <div class="ministry-divider">
              <span class="divider-line"></span>
              <span class="divider-diamond">โ</span>
              <span class="divider-line"></span>
            </div>
            <h2 class="ministry-name">ุฏ ุนุฏู ูุฒุงุฑุช</h2>
            <h3 class="department-name">ูุงูู ุงู ุงุฏุงุฑู ูุนูุช</h3>
            <h3 class="department-name">ุฏ ุงูุณุฌุงู ูู ุฑุงุณุช</h3>
             
            <h4 class="sub-department">ุฏ ูุนุงููุงุชู ูุงุฑฺูุงูู ุงู ุนุฑุถู ูฺฉููฺฉู ฺุงุฑู ุฑุงุณุช</h4>
          </div>

          <!-- Left Column: Logo & Photo -->
          <div class="header-left">
            <div class="logo-photo-stack">
              <img src="/assets/img/mcitlogo.png" alt="ููฺฏู ูุฒุงุฑุช" class="ministry-logo">
              <div class="photo-container">
                <div class="photo-frame">
                  <img [src]="filePath" alt="ุนฺฉุณ" class="owner-photo" onerror="this.src='assets/img/avatar2.png'">
                </div>
               
              </div>
            </div>
          </div>
        </header>

        <!-- Title Banner -->
        <div class="title-banner">
          <div class="banner-decoration left"></div>
          <div class="title-content-wrapper">
            <!-- License Type Badge -->
            <div class="license-type-badge">
              <span class="license-type-icon">
                <ng-container *ngIf="getLicenseTypeInPashto(data.licenseType) === 'ุงููุงฺฉ'">๐ข</ng-container>
                <ng-container *ngIf="getLicenseTypeInPashto(data.licenseType) === 'ูููผุฑ ูุฑูุด'">๐</ng-container>
              </span>
              <span class="license-type-label">ุฏ ุฌูุงุฒ ฺูู:</span>
              <span class="license-type-value">{{getLicenseTypeInPashto(data.licenseType)}}</span>
            </div>
            <h2 class="certificate-title">
              ุฏ ูุนุงููุงุชู ูุงุฑฺูุฏ ุฏ ูุนุงูุช ุฌูุงุฒูุงูู
              <span class="title-highlight">({{data.title || 'โ'}})</span>
            </h2>
          </div>
          <div class="banner-decoration right"></div>
        </div>

        <!-- Main Body -->
        <main class="certificate-body">
          <!-- Personal Information Card -->
          <div class="info-card personal-info">
            <p class="info-paragraph">
              ูุญุชุฑู <span class="highlight-value">{{data.firstName || 'โ'}}</span>
              ุฏ <span class="highlight-value">{{data.fatherName || 'โ'}}</span>
              ุฒู ุฏ <span class="highlight-value">{{data.grandFatherName || 'โ'}}</span>
              ููุณ ุฏ <span class="highlight-value">{{data.dateOfBirthFormatted || (data.dateofBirth | calendarDate)
                || 'โ'}}</span>
              ฺฉุงู ุฒฺุฏู ุฏ ุงูฺฉุชุฑููฺฉู ุชุฐฺฉุฑ ูุฑููฺฉ <span class="highlight-value">{{data.indentityCardNumber || 'โ'}}</span>
            </p>
          </div>

          <!-- Address Information -->
          <div class="info-card address-info">
            <p class="info-paragraph">
              <span class="label-accent">ุงุตูู ุงุณุชูฺซูฺุง ูุงุญู ุง ููุณูุงู</span>
              <span class="highlight-value">{{data.ownerDistrictName || 'โ'}}</span>
              <span class="label-accent">ููุงุช</span>
              <span class="highlight-value">{{data.ownerProvinceName || 'โ'}}</span>
              <span class="label-accent">ุงูุณู ุงุณุชูฺซูฺุง ูุงุญู ุง ููุณูุงู</span>
              <span class="highlight-value">{{data.permanentDistrictName || 'โ'}}</span>
              <span class="label-accent">ููุงุช</span>
              <span class="highlight-value">{{data.permanentProvinceName || 'โ'}}</span>
              
            </p>
          </div>

          <!-- Authorization Statement -->
          <div class="info-card authorization-card">
            <p class="info-paragraph authorization-text">
              <span class="label-accent">ูุงูุน ูุงุญู</span>
              <span class="highlight-value">({{data.ownerVillage || data.ownerVillage || 'โ'}}).</span>
              ุฏ ูุนุงููุงุชู ูุงุฑฺูุฏ ูุงููู ูพู ูพุงู ฺฉ ูููู ุณุฑู ุฏุง ุฌูุงุฒูุงูู ูุฑฺฉูู ฺฉฺู
              <br>
              ุงู ูพุฑ ุงุณุงุณ  ููุตูู ฺฉููุง ุดู ุฏ ูุงููู ุฏ ุญฺฉูููู ูพู ุญุฏูุฏู ฺฉ ุฏ ุงุดุฎุงุตู ุชุฑ ููฺ ูพู ุนููุฏู ุงู ูุนุงููุงุชู ฺฉ ููฺฺซฺุชูุจ ูฺฉฺู.
            </p>
          </div>

          <!-- Inquiry Reference -->
          <div class="inquiry-line">
            <span>ุฏ ุงุณุชุนูุงู ูพู ุดูุฑู</span>
            <span
              class="inquiry-field">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span>ูุทุจุน ุชู ูุนุฑูู ุดู.</span>
          </div>

          <!-- Signature Section -->
          <div class="signature-section">
            <div class="signature-block">
              <p class="signature-greeting">ูพู ุฏุฑูุงูู</p>
              <div class="signature-line"></div>
              <p class="signature-title">ุฏ ุงูุณุฌุงู ูู ุฑุฆุณ</p>
            </div>
          </div>
        </main>

        <!-- Footer Section -->
        <footer class="certificate-footer">
          <!-- Office Address -->
          <div class="footer-row address-row">
            <span class="footer-label">ุฏ ูุนุงููุงุชู ูุงุฑฺูุฏ ุฏูุชุฑ ูพุชู:</span>
            <span class="footer-value">{{data.officeAddress || 'โ'}}</span>
          </div>

          <!-- Important Note -->
          <div class="validity-notice">
            <span class="notice-icon">๐</span>
            <span class="notice-label">ุงุฏฺุช:</span>
            <span class="notice-text">ุฏ ุฏ ุฌูุงุฒูุงู ุฏ ุงุนุชุจุงุฑ ููุฏู ุฏ ุตุฏูุฑ ูู ููผ ฺุฎู ุฏ ุฏุฑู ฺฉูููู ููพุงุฑู ุฏู.</span>
          </div>

          <!-- License Details Row -->
          <div class="footer-row details-row">
            <span>ุฏ ุฌูุงุฒูุงู ูุฑููฺฉู ุฏ ุชูุงุณ ุดูุฑู: <strong class="footer-value">{{data.phoneNumber || 'โ'}}</strong></span>
            <span>ุฏ ูพฺูุฏู ุดูุฑู <strong class="footer-value">{{data.tin || 'โ'}}</strong></span>
            <span>ุฏ ุฌูุงุฒูุงู ุจู: <strong class="footer-value">ูพูฺูุณ ุฒุฑู ุงูุบุงู</strong></span>
          </div>

          <!-- QR Code Verification Row -->
          <div class="verification-row" *ngIf="verificationCode">
            <div class="qr-code-container">
              <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" *ngIf="qrCodeUrl">
            </div>
            <div class="verification-details">
              <div class="verification-item">
                <span class="verification-label">ุฏ ุณูุฏ ุฏ ุชุตุฏู ฺฉูฺ:</span>
                <span class="verification-code">{{ verificationCode }}</span>
              </div>
              <div class="verification-item">
                <span class="verification-label">ุดูุฑุช:</span>
                <span class="verification-value">{{ data.firstName || 'โ' }} {{ data.fatherName || 'โ' }}</span>
              </div>
            </div>
          </div>

          <!-- Verification Error -->
          <div class="verification-row error" *ngIf="verificationError && !verificationCode">
            <div class="error-content">
              <span class="error-text">{{ verificationError }}</span>
              <span class="verification-label">ุฏ ุชุตุฏู ููพุงุฑู ูู ุงุฏุงุฑ ุณุฑู ุงฺฺฉู ููุณุฆ</span>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>
</div>