<!-- Loading Indicator -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner">
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
    <div class="spinner-ring"></div>
  </div>
  <p>ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ูุนูููุงุช ุฌูุงุฒ...</p>
</div>

<div *ngIf="!isLoading && error" class="error-container">
  <div class="error-icon">โ</div>
  <p>{{ error }}</p>
</div>

<div class="certificate-page" *ngIf="!isLoading && !error">
  <div class="certificate-wrapper">
    <!-- Watermark Background -->
    <div class="watermark-layer">
      <div class="watermark-circle">
        <div class="watermark-text">
          <div class="watermark-line">{{data.licenseNumber || 'โ'}}</div>
          <div class="watermark-line">{{data.firstName || 'โ'}}</div>
          <div class="watermark-line">{{data.fatherName || 'โ'}}</div>
          <div class="watermark-line">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'โ'}}</div>
          <div class="watermark-line">{{data.indentityCardNumber || 'โ'}}</div>
        </div>
      </div>
    </div>
    
    <!-- Guilloche Pattern Border -->
    <div class="guilloche-border">
      <svg class="guilloche-pattern" viewBox="0 0 100 100" preserveAspectRatio="none">
        <defs>
          <pattern id="guillochePattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <circle cx="10" cy="10" r="8" fill="none" stroke="rgba(25, 118, 210, 0.15)" stroke-width="0.5"/>
            <circle cx="10" cy="10" r="5" fill="none" stroke="rgba(25, 118, 210, 0.1)" stroke-width="0.3"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#guillochePattern)"/>
      </svg>
    </div>

    <!-- Main Certificate Frame -->
    <div class="certificate-frame">
      <!-- Ornate Corner Decorations -->
      <div class="corner-ornament top-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,60 Q0,0 60,0" fill="none" stroke="#1565c0" stroke-width="2"/>
          <path d="M5,60 Q5,5 60,5" fill="none" stroke="#42a5f5" stroke-width="1"/>
          <circle cx="15" cy="45" r="3" fill="#1976d2"/>
          <circle cx="45" cy="15" r="3" fill="#1976d2"/>
        </svg>
      </div>
      <div class="corner-ornament top-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,60 Q60,0 0,0" fill="none" stroke="#1565c0" stroke-width="2"/>
          <path d="M55,60 Q55,5 0,5" fill="none" stroke="#42a5f5" stroke-width="1"/>
          <circle cx="45" cy="45" r="3" fill="#1976d2"/>
          <circle cx="15" cy="15" r="3" fill="#1976d2"/>
        </svg>
      </div>
      <div class="corner-ornament bottom-right">
        <svg viewBox="0 0 60 60">
          <path d="M0,0 Q0,60 60,60" fill="none" stroke="#1565c0" stroke-width="2"/>
          <path d="M5,0 Q5,55 60,55" fill="none" stroke="#42a5f5" stroke-width="1"/>
          <circle cx="15" cy="15" r="3" fill="#1976d2"/>
          <circle cx="45" cy="45" r="3" fill="#1976d2"/>
        </svg>
      </div>
      <div class="corner-ornament bottom-left">
        <svg viewBox="0 0 60 60">
          <path d="M60,0 Q60,60 0,60" fill="none" stroke="#1565c0" stroke-width="2"/>
          <path d="M55,0 Q55,55 0,55" fill="none" stroke="#42a5f5" stroke-width="1"/>
          <circle cx="45" cy="15" r="3" fill="#1976d2"/>
          <circle cx="15" cy="45" r="3" fill="#1976d2"/>
        </svg>
      </div>

      <!-- Certificate Content -->
      <div class="certificate-content">
        <!-- Header Section -->
        <header class="certificate-header">
          <!-- Right Column: National Emblem & License Info -->
          <div class="header-right">
            <div class="emblem-container">
              <img src="/assets/img/afg.png" alt="ูุดุงู ูู ุงูุบุงูุณุชุงู" class="national-emblem">
            </div>
            <div class="license-meta">
              <div class="meta-item">
                <span class="meta-label">ุดูุงุฑู ุฌูุงุฒูุงูู</span>
                <span class="meta-value">({{data.licenseNumber || 'โ'}})</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">ุชุงุฑุฎ ุตุฏูุฑ:</span>
                <span class="meta-value">{{data.issueDateFormatted || (data.issueDate | calendarDate) || 'โ'}}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">ุชุงุฑุฎ ุฎุชู:</span>
                <span class="meta-value">{{data.expireDateFormatted || (data.expireDate | calendarDate) || 'โ'}}</span>
              </div>
            </div>
          </div>

          <!-- Center Column: Ministry Info -->
          <div class="header-center">
            <h1 class="ministry-title">ุงูุงุฑุช ุงุณูุงู ุงูุบุงูุณุชุงู</h1>
            <div class="ministry-divider">
              <span class="divider-line"></span>
              <span class="divider-diamond">โ</span>
              <span class="divider-line"></span>
            </div>
            <h2 class="ministry-name">ูุฒุงุฑุช ุนุฏูู</h2>
            <h3 class="department-name">ุฑุงุณุช ุนููู ุงูุณุฌุงู</h3>
            <h4 class="sub-department">ุฑุงุณุช ุงููุฑ ุฑูููุง ูุนุงููุงุช ู ุนุฑุถู ููุณุงู</h4>
          </div>

          <!-- Left Column: Logo & Photo -->
          <div class="header-left">
            <div class="logo-photo-stack">
              <img src="/assets/img/mcitlogo.png" alt="ููฺฏู ูุฒุงุฑุช" class="ministry-logo">
              <div class="photo-container">
                <div class="photo-frame">
                  <img [src]="filePath" alt="ุนฺฉุณ" class="owner-photo" onerror="this.src='assets/img/avatar2.png'">
                </div>
                <div class="photo-label">ุนฺฉุณ ุฏุงุฑูุฏู ุฌูุงุฒ</div>
              </div>
            </div>
          </div>
        </header>

        <!-- Title Banner -->
        <div class="title-banner">
          <div class="banner-decoration left"></div>
          <h2 class="certificate-title">
            <span class="title-icon">๐</span>
            ุฌูุงุฒูุงูู ูุนุงูุช ุฑูููุง ูุนุงููุงุช
            <span class="title-highlight">({{data.title || 'โ'}})</span>
          </h2>
          <div class="banner-decoration right"></div>
        </div>

        <!-- Main Body -->
        <main class="certificate-body">
          <!-- Personal Information Card -->
          <div class="info-card personal-info">
            <p class="info-paragraph">
              ูุญุชุฑู <span class="highlight-value">({{data.firstName || 'โ'}})</span>
              ููุฏ <span class="highlight-value">({{data.fatherName || 'โ'}})</span>
              ููุฏุช <span class="highlight-value">({{data.grandFatherName || 'โ'}})</span>
              ูุชููุฏ ุณุงู <span class="highlight-value">({{data.dateOfBirthFormatted || (data.dateofBirth | calendarDate) || 'โ'}})</span>
              ุฏุงุฑูุฏู ุชุฐฺฉุฑู ุงูฺฉุชุฑููฺฉ <span class="highlight-value">({{data.indentityCardNumber || 'โ'}})</span>
            </p>
          </div>

          <!-- Address Information -->
          <div class="info-card address-info">
            <p class="info-paragraph">
              <span class="label-accent">ูุณฺฉููู ุงุตู ููุณูุงู</span>
              <span class="highlight-value">({{data.permanentDistrictName || 'โ'}})</span>
              <span class="label-accent">ููุงุช</span>
              <span class="highlight-value">({{data.permanentProvinceName || 'โ'}})</span>
              <span class="label-accent">ูุณฺฉููู ูุนู ูุงุญู ุง ููุณูุงู</span>
              <span class="highlight-value">({{data.temporaryDistrictName || 'โ'}})</span>
              <span class="label-accent">ููุงุช</span>
              <span class="highlight-value">({{data.temporaryProvinceName || 'โ'}})</span>
            </p>
          </div>

          <!-- Authorization Statement -->
          <div class="info-card authorization-card">
            <p class="info-paragraph">
              <span class="label-accent">ูุงูุน ูุงุญู</span>
              <span class="highlight-value">({{data.temporaryVillage || data.permanentVillage || 'โ'}})</span>
              ุจุง ุฏุฑ ูุธุฑุฏุงุดุช ุงุญฺฉุงู ููุฏุฑุฌ ููุฑู (4) ูุงุฏู (13) ูุงููู ุฑูููุง ูุนุงููุงุช ุงู ุฌูุงุฒูุงูู ุงุนุทุงุก ู ุจู ุงุณุงุณ ุขู ููุตูู ูุชูุงูุฏ ุฏุฑ ุญุฏูุฏ ุงุญฺฉุงู ูุงููู ุฏุฑ ุนููุฏ ู ูุนุงููุงุช ุจู ุงุดุฎุงุต ูุณุงุทุช ููุงุฏ.
            </p>
          </div>

          <!-- Inquiry Reference -->
          <div class="inquiry-line">
            <span>ุฐุฑุนู ุงุณุชุนูุงู ููุจุฑ</span>
            <span class="inquiry-field">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span>ุจู ูุทุจุนู ูุนุฑู ุดุฏ.</span>
          </div>

          <!-- Signature Section -->
          <div class="signature-section">
            <div class="signature-block">
              <p class="signature-greeting">ุจุงุงุญุชุฑุงู</p>
              <div class="signature-line"></div>
              <p class="signature-title">ุฑุฆุณ ุนููู ุงูุณุฌุงู</p>
            </div>
          </div>
        </main>

        <!-- Footer Section -->
        <footer class="certificate-footer">
          <!-- Office Address -->
          <div class="footer-row address-row">
            <span class="footer-label">ุขุฏุฑุณ ุฏูุชุฑ ุฑูููุง ูุนุงููุงุช:</span>
            <span class="footer-value">({{data.officeAddress || 'โ'}})</span>
          </div>

          <!-- Important Note -->
          <div class="validity-notice">
            <span class="notice-icon">๐</span>
            <span class="notice-label">ููุช:</span>
            <span class="notice-text">ูุฏุช ุงุนุชุจุงุฑ ุงู ุฌูุงุฒูุงูู ุงุฒ ุชุงุฑุฎ ุตุฏูุฑ ุจุฑุง ูุฏุช ุณู ุณุงู ู ุจุงุดุฏ.</span>
          </div>

          <!-- License Details Row -->
          <div class="footer-row details-row">
            <span>ุดูุงุฑู ุชูุงุณ ุฏุงุฑูุฏู ุฌูุงุฒูุงูู: <strong class="footer-value">({{data.phoneNumber || 'โ'}})</strong></span>
            <span>ููุจุฑ ุชุดุฎุตู <strong class="footer-value">({{data.tin || 'โ'}})</strong></span>
            <span>ููุช ุฌูุงุฒ ูุงูู: <strong class="footer-value">(ูพุงูุฒุฏู ูุฒุงุฑ ุงูุบุงู)</strong></span>
          </div>

          <!-- QR Code Verification Row -->
          <div class="verification-row" *ngIf="verificationCode">
            <div class="qr-code-container">
              <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" *ngIf="qrCodeUrl">
            </div>
            <div class="verification-details">
              <div class="verification-item">
                <span class="verification-label">ฺฉูุฏ ุชุตุฏู ุณูุฏ:</span>
                <span class="verification-code">{{ verificationCode }}</span>
              </div>
              <div class="verification-item">
                <span class="verification-label"> ุดูุฑุช :</span>
                <span class="verification-value">{{ data.firstName || 'โ' }} {{ data.fatherName || 'โ' }}</span>
              </div>
            </div>
          </div>

          <!-- Verification Error -->
          <div class="verification-row error" *ngIf="verificationError && !verificationCode">
            <div class="error-content">
              <span class="error-text">{{ verificationError }}</span>
              <span class="verification-label">ุจุฑุง ุชุตุฏู ุจุง ุงุฏุงุฑู ุชูุงุณ ุจฺฏุฑุฏ</span>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>
</div>
